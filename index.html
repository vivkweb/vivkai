<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>موقعي — مثال تفاعلي</title>
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --accent:#ff6b6b; --muted:#9aa4b2;
      --glass: rgba(255,255,255,0.03);
      font-family: "Segoe UI", Roboto, "Noto Naskh Arabic", system-ui, sans-serif;
    }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#071028 0%, #0b1220 100%);color:#e6eef6}
    .app{max-width:1100px;margin:28px auto;padding:18px;display:grid;grid-template-columns: 280px 1fr;gap:18px;}
    .sidebar{background:var(--card);border-radius:12px;padding:14px;box-shadow:0 6px 18px rgba(2,6,23,.6)}
    .logo{font-weight:700;font-size:20px;margin-bottom:10px}
    .nav a{display:block;padding:10px;border-radius:8px;color:inherit;text-decoration:none;margin-bottom:6px}
    .nav a.active{background:var(--glass);box-shadow:inset 0 0 0 1px rgba(255,255,255,0.02)}
    .lang-switch{display:flex;gap:8px;margin-top:12px}
    .lang-switch button{flex:1;padding:8px;border-radius:8px;border:none;background:transparent;color:var(--muted);cursor:pointer}
    .main{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:18px;min-height:60vh}
    .header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    .card{background:var(--glass);padding:12px;border-radius:10px;margin-bottom:12px}
    .chat{height:320px;overflow:auto;padding:12px;border-radius:8px;background:rgba(0,0,0,0.25);margin-bottom:12px}
    .msg{margin-bottom:8px;padding:8px;border-radius:8px;max-width:78%}
    .msg.user{background:rgba(255,255,255,0.06);margin-inline-start:auto;text-align:right}
    .msg.bot{background:rgba(255,255,255,0.03);text-align:left}
    .controls{display:flex;gap:8px}
    input[type="text"]{flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    button.primary{padding:10px 14px;border-radius:8px;border:none;background:var(--accent);color:#0b1220;cursor:pointer}
    button.danger{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);cursor:pointer}
    .small{font-size:13px;color:var(--muted)}
    .right{text-align:right}
    .hidden{display:none}
    /* responsive */
    @media (max-width:880px){
      .app{grid-template-columns:1fr; padding:12px}
      .sidebar{order:2}
    }
  </style>
</head>
<body>
  <div class="app" id="app">
    <aside class="sidebar" aria-label="الشريط الجانبي">
      <div class="logo" id="app-title">موقعي</div>
      <nav class="nav" id="nav">
        <a href="#/" data-route="/" class="active" id="link-home">الصفحة الرئيسية</a>
        <a href="#/about" data-route="/about" id="link-about">عن الموقع</a>
        <a href="#/chat" data-route="/chat" id="link-chat">الشات الجاهز</a>
        <a href="#/settings" data-route="/settings" id="link-settings">الإعدادات</a>
      </nav>

      <div style="margin-top:12px" class="small">اللغة</div>
      <div class="lang-switch" role="tablist" aria-label="تبديل اللغة">
        <button id="lang-ar" data-lang="ar">العربية</button>
        <button id="lang-en" data-lang="en">English</button>
        <button id="lang-es" data-lang="es">Español</button>
      </div>

      <div style="margin-top:12px" class="card small">
        <div>حذف المحادثات</div>
        <div style="margin-top:8px">
          <button id="delete-all" class="danger">حذف الكل</button>
        </div>
      </div>

      <div class="card small" style="margin-top:8px">
        <div>روابط مفيدة</div>
        <div style="margin-top:8px"><a href="#/about" style="color:inherit">كيف يعمل التنقّل؟</a></div>
      </div>
    </aside>

    <main class="main" id="main">
      <!-- محتوى ديناميكي -->
    </main>
  </div>

<script>
/* ====== بيانات الترجمة والردود النموذجية ====== */
const LOCALES = {
  ar: {
    title: "موقعي",
    home_title: "مرحبًا بك — الصفحة الرئيسية",
    home_sub: "هذا مثال لموقع يعمل بنسبة 100%، يدعم تنقّل، ثلاث لغات، وردود جاهزة.",
    about_title: "عن الموقع",
    about_text: "هذا نموذج عملي مبني ليوضّح حل مشاكل الانتقال وواجهة المستخدم. انسخ الملف إلى مشروعك.",
    chat_title: "الشات الجاهز",
    input_placeholder: "اكتب رسالتك هنا...",
    send: "أرسل",
    delete_confirm: "تم حذف كل المحادثات.",
    sample_responses_title: "ردود نموذجية قوية (قابلة للتعديل)",
    settings_title: "الإعدادات",
    settings_text: "يمكنك تغيير اللغة، حذف المحادثات، أو تعديل الردود النموذجية.",
    sample_responses: [
      { role: "bot", text: "مرحبًا! كيف أستطيع مساعدتك اليوم؟" },
      { role: "bot", text: "هل تريد نسخة من الصفحة قابلة للطباعة؟ أرسِل 'اطبع'." },
      { role: "bot", text: "تم حفظ طلبك — سنبلّغك بالتحديثات." },
      { role: "bot", text: "عذرًا، لم أفهم ذلك. هل يمكنك إعادة الصياغة؟" }
    ]
  },
  en: {
    title: "MySite",
    home_title: "Welcome — Home",
    home_sub: "A working example: navigation, 3 languages, and strong canned replies.",
    about_title: "About",
    about_text: "This is a practical template that fixes navigation and UI issues. Drop into your project.",
    chat_title: "Ready Chat",
    input_placeholder: "Type your message...",
    send: "Send",
    delete_confirm: "All chats deleted.",
    sample_responses_title: "Strong canned responses (editable)",
    settings_title: "Settings",
    settings_text: "Change language, clear chats, or edit canned replies.",
    sample_responses: [
      { role: "bot", text: "Hello! How can I help you today?" },
      { role: "bot", text: "Would you like a printable copy of this page? Type 'print'." },
      { role: "bot", text: "Your request was saved — we'll notify you of updates." },
      { role: "bot", text: "Sorry, I didn't understand. Could you rephrase?" }
    ]
  },
  es: {
    title: "MiSitio",
    home_title: "Bienvenido — Inicio",
    home_sub: "Ejemplo funcional: navegación, 3 idiomas y respuestas predefinidas poderosas.",
    about_title: "Acerca de",
    about_text: "Plantilla práctica que soluciona navegación e interfaz. Colócala en tu proyecto.",
    chat_title: "Chat listo",
    input_placeholder: "Escribe tu mensaje...",
    send: "Enviar",
    delete_confirm: "Todas las conversaciones eliminadas.",
    sample_responses_title: "Respuestas prediseñadas fuertes (editable)",
    settings_title: "Ajustes",
    settings_text: "Cambia idioma, borra chats, o edita respuestas prediseñadas.",
    sample_responses: [
      { role: "bot", text: "¡Hola! ¿En qué puedo ayudarte hoy?" },
      { role: "bot", text: "¿Deseas una copia imprimible? Escribe 'imprimir'." },
      { role: "bot", text: "Tu solicitud fue guardada — te notificaremos." },
      { role: "bot", text: "Lo siento, no entendí. ¿Puedes reformular?" }
    ]
  }
};

/* ====== بسيطة: تخزين محادثات محليًا ====== */
const STORAGE_KEY = "site_demo_chats_v1";
const LANG_KEY = "site_demo_lang_v1";

/* ====== Router بسيط مبني على hash ====== */
const routes = {
  "/": renderHome,
  "/about": renderAbout,
  "/chat": renderChat,
  "/settings": renderSettings
};

function getLang(){ return localStorage.getItem(LANG_KEY) || "ar"; }
let currentLang = getLang();

/* ==== helpers ==== */
function t(k){ // وصول سريع: t('home_title')
  const segs = k.split('.');
  let cur = LOCALES[currentLang];
  for (let p of segs){ cur = cur?.[p] ?? null; if (!cur) break; }
  return cur ?? k;
}

function setActiveLink(path){
  document.querySelectorAll('.nav a').forEach(a=>{
    a.classList.toggle('active', a.getAttribute('data-route') === path);
  });
}

/* ==== render pages ==== */
function renderHome(){
  setActiveLink('/');
  const html = `
    <div class="header">
      <div>
        <h2>${t('home_title')}</h2>
        <div class="small">${t('home_sub')}</div>
      </div>
      <div class="small">${currentLang.toUpperCase()}</div>
    </div>

    <div class="card">
      <strong>${t('sample_responses_title')}</strong>
      <div style="margin-top:8px" class="small">${generateSampleList()}</div>
    </div>

    <div class="card">
      <strong>${t('about_title')}</strong>
      <div class="small">${t('about_text')}</div>
    </div>
  `;
  document.getElementById('main').innerHTML = html;
}

function generateSampleList(){
  return LOCALES[currentLang].sample_responses.map(s=>`• ${s.text}`).join('<br>');
}

function renderAbout(){
  setActiveLink('/about');
  const html = `
    <div class="header">
      <h2>${t('about_title')}</h2>
    </div>
    <div class="card small">${t('about_text')}</div>
  `;
  document.getElementById('main').innerHTML = html;
}

function renderChat(){
  setActiveLink('/chat');
  const saved = loadChats();
  const html = `
    <div class="header">
      <h2>${t('chat_title')}</h2>
      <div class="small">${Object.keys(saved).length ? ('المحادثات المحفوظة: ' + Object.keys(saved).length) : 'لا توجد محادثات'}</div>
    </div>

    <div class="card">
      <div class="chat" id="chat-box">
        ${renderMessages(saved)}
      </div>

      <div class="controls" style="margin-top:8px">
        <input id="user-input" placeholder="${t('input_placeholder')}" />
        <button id="send-btn" class="primary">${t('send')}</button>
      </div>

      <div style="margin-top:8px" class="small">
        <strong>نصائح:</strong> هذه الردود النموذجية مُخزنة داخل الكود وتستطيع تعديلها في LOCALES[lang].sample_responses
      </div>
    </div>
  `;
  document.getElementById('main').innerHTML = html;

  document.getElementById('send-btn').addEventListener('click', onSend);
  document.getElementById('user-input').addEventListener('keydown', (e)=>{
    if(e.key === 'Enter') onSend();
  });
}

function renderMessages(saved){
  // saved is object with arrays; for demo: use single thread called "default"
  const msgs = saved['default'] || [];
  // if empty, preload with sample bot response
  if(msgs.length === 0){
    const sample = LOCALES[currentLang].sample_responses;
    for (let i=0;i<Math.min(2,sample.length);i++){
      msgs.push({role:'bot', text: sample[i].text, ts: Date.now()- (1000*(i+1))});
    }
    saveChats({default: msgs});
  }
  return msgs.map(m=>`<div class="msg ${m.role==='user'?'user':'bot'}"><div>${escapeHtml(m.text)}</div></div>`).join('');
}

function renderSettings(){
  setActiveLink('/settings');
  const sr = LOCALES[currentLang].sample_responses.map((s, idx)=> `
    <div style="display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px;margin-bottom:6px;background:rgba(255,255,255,0.02)">
      <div style="flex:1">${escapeHtml(s.text)}</div>
      <div><button data-idx="${idx}" class="edit-sample small">تعديل</button></div>
    </div>
  `).join('');
  const html = `
    <div class="header"><h2>${t('settings_title')}</h2></div>
    <div class="card small">${t('settings_text')}</div>
    <div style="margin-top:12px">${sr}</div>
  `;
  document.getElementById('main').innerHTML = html;
  document.querySelectorAll('.edit-sample').forEach(btn=>{
    btn.addEventListener('click', (e)=>{
      const idx = +btn.getAttribute('data-idx');
      const newText = prompt("عدل النص:", LOCALES[currentLang].sample_responses[idx].text);
      if(newText !== null){
        LOCALES[currentLang].sample_responses[idx].text = newText;
        renderSettings();
      }
    });
  });
}

/* ====== Storage helpers ====== */
function loadChats(){
  try{
    return JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
  }catch(e){ return {}; }
}
function saveChats(obj){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(obj));
}

/* ====== events ====== */
function onSend(){
  const input = document.getElementById('user-input');
  const text = (input.value || "").trim();
  if(!text) return;
  const saved = loadChats();
  if(!saved['default']) saved['default'] = [];
  saved['default'].push({role:'user', text, ts:Date.now()});
  // choose canned response by keyword or fallback
  const canned = chooseCannedResponse(text);
  saved['default'].push({role:'bot', text: canned, ts:Date.now()+5});
  saveChats(saved);
  // re-render chat messages
  const box = document.getElementById('chat-box');
  if(box) box.innerHTML = renderMessages(saved);
  input.value = '';
  box.scrollTop = box.scrollHeight;
}

function chooseCannedResponse(text){
  text = text.toLowerCase();
  const samples = LOCALES[currentLang].sample_responses.map(s=>s.text);
  // keyword logic simple:
  if(text.includes('طباعة') || text.includes('print') || text.includes('imprimir')) return samples[1] || samples[0];
  if(text.includes('حفظ') || text.includes('save')) return samples[2] || samples[0];
  if(text.includes('؟') || text.length < 3) return samples[3] || samples[0];
  // otherwise return best match (first)
  return samples[0] || "تم استلام الرسالة.";
}

/* ====== delete all chats ====== */
document.getElementById('delete-all').addEventListener('click', ()=>{
  localStorage.removeItem(STORAGE_KEY);
  alert(t('delete_confirm'));
  const path = location.hash.replace('#','') || '/';
  navigateTo(path);
});

/* ====== language switch ====== */
document.querySelectorAll('.lang-switch button').forEach(b=>{
  b.addEventListener('click',(e)=>{
    const l = b.getAttribute('data-lang');
    currentLang = l;
    localStorage.setItem(LANG_KEY, l);
    // adjust dir for Arabic
    if(l === 'ar'){ document.documentElement.dir = 'rtl'; document.documentElement.lang='ar'; }
    else { document.documentElement.dir = 'ltr'; document.documentElement.lang = (l==='es'?'es':'en'); }
    renderCurrentRoute();
    // update title and sidebar
    document.getElementById('app-title').textContent = LOCALES[currentLang].title;
  });
});

/* ====== Router actions ====== */
function renderCurrentRoute(){
  const path = (location.hash.replace('#','') || '/').split('?')[0];
  const render = routes[path] || renderHome;
  render();
}
function navigateTo(path){
  location.hash = path;
}

/* hash change listener for navigation */
window.addEventListener('hashchange', renderCurrentRoute);
window.addEventListener('load', ()=>{
  // initial language setup
  currentLang = getLang();
  document.getElementById('app-title').textContent = LOCALES[currentLang].title;
  if(currentLang === 'ar'){ document.documentElement.dir='rtl'; } else { document.documentElement.dir='ltr'; }
  // attach click prevention? Not needed. Links are hash-based.
  renderCurrentRoute();
});

/* utility: escape HTML to avoid injection */
function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[c])); }

/* ensure nav links highlight when clicked (works also when clicking anchors) */
document.querySelectorAll('.nav a').forEach(a=>{
  a.addEventListener('click', (e)=>{
    // allow default anchor (hash) to change location => hashchange triggers render
    // but we also set active immediately for snappiness
    const path = a.getAttribute('data-route');
    setActiveLink(path);
  });
});
</script>
</body>
</html>